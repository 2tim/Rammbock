*** Settings ***
Test Setup      Create Two TCP Servers And Clients
Test Teardown   Delete Two Servers And Clients And Verify Deletion
Default Tags    regression
Resource        resources/data_transfer.txt
Resource        resources/server_client.txt

*** Variables ***
${LOCALHOST_IP}  127.0.0.1
${SERVER_NAME1}  testiserveri1
${SERVER_NAME2}  testiserveri2
${DEFAULT_PORT1}  3011
${DEFAULT_PORT2}  23205
${CLIENT_NAME1}  testiclient1
${CLIENT_NAME2}  testiclient2

*** Test Cases ***
Create and delete two instances of Servers
    Server Should Be Running  ${SERVER_NAME1}
    Server Should Be Running  ${SERVER_NAME2}

Create and delete two instances of Clients
    Client Should Be Running  ${CLIENT_NAME1}
    Client Should Be Running  ${CLIENT_NAME2}

Send data between multiple Client and Server instances
    Client Connects to TCP server  ${HOST}  ${DEFAULT_PORT1}  ${CLIENT_NAME1}
    Server Accepts TCP Connection  ${SERVER_NAME1}
    Client Connects to TCP server  ${HOST}  ${DEFAULT_PORT2}  ${CLIENT_NAME2}
    Server Accepts TCP Connection  ${SERVER_NAME2}
    Client Transfers Data  ${CLIENT_NAME1}
    Server Receives packet  ${SERVER_NAME1}
    Client Transfers Data  ${CLIENT_NAME2}
    Server Receives packet  ${SERVER_NAME2}
    Server Sends packet  ${SERVER_NAME1}
    Client Receives Packet  ${CLIENT_NAME1}
    Server Sends packet  ${SERVER_NAME2}
    Client Receives Packet  ${CLIENT_NAME2}

Create Two UDP Server Instances without name
    [Tags]  ${EMPTY}
    [Setup]
    Create First UDP Server
    Create Second UDP Server and Expect Error
    [Teardown]

Create Two Client instances without names
    [Tags]  ${EMPTY}

Send message from last created client
    [Tags]  ${EMPTY}

Receive Message from last created Server
    [Tags]  ${EMPTY}

*** Keywords ***
Create Two TCP Servers And Clients
    Create TCP Server  ${LOCALHOST_IP}  ${DEFAULT_PORT1}  ${SERVER_NAME1}
    Create TCP Server  ${LOCALHOST_IP}  ${DEFAULT_PORT2}  ${SERVER_NAME2}
    Create TCP Client  ${CLIENT_NAME1}
    Create TCP Client  ${CLIENT_NAME2}

Delete Two Servers And Clients And Verify Deletion
    Delete Server  ${SERVER_NAME1}
    Run Keyword And Expect Error  *  Server Should Be Running  ${SERVER_NAME1}
    Delete Server  ${SERVER_NAME2}
    Run Keyword And Expect Error  *  Server Should Be Running  ${SERVER_NAME2}
    Delete Client  ${CLIENT_NAME1}
    Run Keyword And Expect Error  *  Server Should Be Running  ${CLIENT_NAME1}
    Delete Client  ${CLIENT_NAME2}
    Run Keyword And Expect Error  *  Server Should Be Running  ${CLIENT_NAME2}

Create First UDP Server
    Create UDP Server  127.0.0.1  65534

Create Second UDP Server and Expect Error
    Run Keyword And Expect Error  There is already one UDP Server created. You need to specify a unique name for a new server  Create UDP Server  127.0.0.1  65535

