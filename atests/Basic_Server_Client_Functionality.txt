*** Settings ***
Default Tags    regression
Library         ../src/Rammbock.py

*** Variables ***
${EXPECTED_STRING}  ismo_rulettaa
${HOST}  localhost
${PORT}  2010
${PHYSICAL_INTERFACE}  lo
${VIRTUAL_HOST}  1.1.1.1
${RECEIVED_STRING}  ${EMPTY}

*** Test Cases ***
Send and Receive string over UDP using physical interface
    [Setup]  Initialize UDP Server and Client to physical interface
    Client Sends String
    Server Receives String
    [Teardown]  Close Connections

Send and Receive string over UDP using virtual interface
    [Setup]  Initialize UDP Client and Server to virtual interface
    Client Sends String
    Server Receives String
    [Teardown]  Close Connections and remove virtual interface

Send data over UDP and modify it and return it back
    [Tags]  ${EMPTY}
    [Setup]  Initialize UDP Server and Client to physical interface
    Client Sends String
    Server Receives String
    Server Modifies String
    Server Sends Modified String
    Client Receives String
    [Teardown]  Close Connections

*** Keywords ***
Server is started
    [Arguments]  ${interface}
    Start Server  ${interface}  ${PORT}

Server Receives String
    ${RECEIVED_STRING}=  receive_packet_over_udp
    Should Be Equal  ${RECEIVED_STRING}  ${EXPECTED_STRING}

Connect to Server
    [Arguments]  ${host}
    Rammbock.connect to server  ${host}  ${PORT}

Client Sends String
    send packet over udp  ${EXPECTED_STRING}

Initialize UDP Server and Client to physical interface
    use interface  PHYSICAL  ${PHYSICAL_INTERFACE}
    Server is Started  PHYSICAL
    Connect to Server  ${HOST}

Close Connections
    Close Client
    Close Server

Initialize UDP Client and Server to virtual interface
    use interface  VIRTUAL_INTERFACE  ${PHYSICAL_INTERFACE}  1.1.1.1  255.255.255.255  True
    Server is Started  VIRTUAL_INTERFACE
    connect to server  ${VIRTUAL_HOST}

Close Connections and remove virtual interface
    Close Client
    Close Server
    Delete Interface  VIRTUAL_INTERFACE

Server Modifies String
    Set Test Variable  \${RECEIVED_STRING}  ${RECEIVED_STRING} _koviten

