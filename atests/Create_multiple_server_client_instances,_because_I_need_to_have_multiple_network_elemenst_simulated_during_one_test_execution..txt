*** Settings ***
Library        rammbock.Rammbock
Resource	   resources/data_transfer.txt
Resource       resources/server_client.txt
Default Tags   regression
Test Setup     Create Two TCP Servers And Clients
Test Teardown  Delete Two Servers And Clients And Verify Deletion

*** Variables ***
${SERVER_NAME1}  testiserveri1
${SERVER_NAME2}  testiserveri2
${DEFAULT_PORT1}  3011
${DEFAULT_PORT2}  23205

${CLIENT_NAME1}  testiclient1
${CLIENT_NAME2}  testiclient2


*** Test Cases ***
Create and delete two instances of Servers
    Check Server Existence  ${SERVER_NAME1}  ${True}
    Check Server Existence  ${SERVER_NAME2}  ${True}

Create and delete two instances of Clients
    Check Client Existence  ${CLIENT_NAME1}  ${True}
    Check Client Existence  ${CLIENT_NAME2}  ${True}

Send data between multiple Client and Server instances
	Connect to TCP server  ${HOST}  ${DEFAULT_PORT1}  ${False}  ${CLIENT_NAME1}
	accept tcp connection  ${SERVER_NAME1}	
	Connect to TCP server  ${HOST}  ${DEFAULT_PORT2}  ${False}  ${CLIENT_NAME2}
	accept tcp connection  ${SERVER_NAME2}	
    Client Transfers Data  ${CLIENT_NAME1}
    Server Receives packet  ${SERVER_NAME1}
    Client Transfers Data  ${CLIENT_NAME2}
    Server Receives packet  ${SERVER_NAME2}
    Server Sends packet  ${SERVER_NAME1}
    Client Receives Packet  ${CLIENT_NAME1}
    Server Sends packet  ${SERVER_NAME2}
    Client Receives Packet  ${CLIENT_NAME2}

*** Keywords ***

Create Two TCP Servers And Clients
    Start TCP Server  ${LOOPBACK_DEVICE}  ${DEFAULT_PORT1}  ${SERVER_NAME1}
    Start TCP Server  ${LOOPBACK_DEVICE}  ${DEFAULT_PORT2}  ${SERVER_NAME2}

    Create TCP Client  ${CLIENT_NAME1}
    Create TCP Client  ${CLIENT_NAME2}

Delete Two Servers And Clients And Verify Deletion
    Close Server  ${SERVER_NAME1}
    Check Server Existence  ${SERVER_NAME1}  ${False}

    Close Server  ${SERVER_NAME2}
    Check Server Existence  ${SERVER_NAME2}  ${False}

    Close Client  ${CLIENT_NAME1}
    Check Client Existence  ${CLIENT_NAME1}  ${False}

    Close Client  ${CLIENT_NAME2}
    Check Client Existence  ${CLIENT_NAME2}  ${False}