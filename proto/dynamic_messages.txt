*** Settings ***
Test Setup        Setup protocol, server, and client
Library           Rammbock.py
Resource          Protocols.txt

*** Variables ***
${SERVER}    127.0.0.1
${SERVER PORT}    54321

*** Test Cases ***
Server uses protocol and receives a dynamic message
    Use protocol    Example    _server=ExampleServer
    Send hex    0x 01 00 aaaa 0e 0000 03 cafebabe d00d    _client=ExampleClient
    ${msg} =    Receive dynamic request    _server=ExampleServer
    Should be equal    ${msg.pair.first.hex}    0xca
    Should be equal    ${msg.pair[0].first.hex}    0xca
    Should be equal    ${msg.pair[0].second.hex}    0xfe
    Should be equal    ${msg.pair[2].first.hex}    0xd0

*** Keywords ***
Send hex
    [Arguments]    ${hex}    @{params}
    ${binary} =    Hex to bin    ${hex}
    Send binary    ${binary}    @{params}

Receive dynamic request
    [Arguments]    @{params}
    New pdu    messageType=0xaaaa
    u8    numberOfPairs
    Struct    numberOfPairs    pair
    u8    first
    u8    second
    End struct    pair
    ${msg} =    Receive pdu    @{params}

